# = INPUT AND OUTPUT FILES =

## Output
OUT_DIR = bin
BIN     = springshell-exp

## Source File(s)
EXT = c
SRC = ${BIN}.${EXT}

## Object File(s)
OBJ_DIR = obj
OBJ     = $(addprefix ${OBJ_DIR}/,$(patsubst %.${EXT},%.o,${SRC}) $(patsubst %.${EXT},%.o,${DEP}))

# = COMPILER OPTIONS =

# Includes and libs
INCS =
LIBS = -lresolv

# Flags
CPPFLAGS =
CFLAGS   = -std=c99 -pedantic -Wall -Wextra -Wno-deprecated-declarations ${INCS} ${CPPFLAGS}
DEBUG   ?= -ggdb

# = TARGETS =

all: ${OBJ_DIR} ${OUT_DIR} ${OUT_DIR}/${BIN}

${OUT_DIR}/${BIN}: ${OBJ}
	${CC} -o $@ ${OBJ} ${LIBS}

${OBJ_DIR}/%.o: %.${EXT}
	${CC} -c -o $@ ${CFLAGS} ${DEBUG} $<

${OBJ_DIR}:
	mkdir -p $(dir ${OBJ})

${OUT_DIR}:
	mkdir $@

release:
	DEBUG= make

clean:
	rm -rf ${OUT_DIR} ${OBJ_DIR} ${BIN}.tar.gz

dist:
	mkdir -p ${BIN}
	cp -R Makefile ${SRC} ${BIN}
	tar -cf ${BIN}.tar ${BIN}
	gzip ${BIN}.tar
	rm -rf ${BIN}

install: all
	mkdir -p ${DESTDIR}${PREFIX}/bin
	cp -f ${OUT_DIR}/${BIN} ${DESTDIR}${PREFIX}/bin
	chmod 755 ${DESTDIR}${PREFIX}/bin/${BIN}

uninstall:
	rm -f ${DESTDIR}${PREFIX}/bin/${BIN}

.PHONY: all release clean install uninstall dist
